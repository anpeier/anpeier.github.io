<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Hexo">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://anpeier.github.io">
    <!--SEO-->

<meta name="keywords" content="" />


<meta name="description" content="快速上手网易云音乐可视化什么是音频可视化
音频可视化，顾名思义，就是通过获取音频的波形、频率和其他来自音频的数据转换成图像，再到屏幕上显示出来。通过它，我们能够制作一些炫酷的前端音乐界面。

下..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    visualize |
    
    Hexo
</title>

<link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

</head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    http://snippet.shenliyang.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='John Doe'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://anpeier.github.io">
                        Hexo</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/前端/"><i class="fa "></i>
                                前端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/后端/"><i class="fa "></i>
                                后端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/工具/"><i class="fa "></i>
                                工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="visualize">
            
            visualize
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2019/11/23</span>
    </span>
    
    <span class="fa-wrap">
        <i class="fa fa-eye"></i>
        <span id="busuanzi_value_page_pv"></span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="快速上手网易云音乐可视化"><a href="#快速上手网易云音乐可视化" class="headerlink" title="快速上手网易云音乐可视化"></a>快速上手网易云音乐可视化</h1><h2 id="什么是音频可视化"><a href="#什么是音频可视化" class="headerlink" title="什么是音频可视化"></a>什么是音频可视化</h2><blockquote>
<p>音频可视化，顾名思义，就是通过获取音频的波形、频率和其他来自音频的数据转换成图像，再到屏幕上显示出来。通过它，我们能够制作一些炫酷的前端音乐界面。</p>
</blockquote>
<p>下面，我将分析一个来自<a href="https://juejin.im/post/5d8c122be51d4578176b4b2b" target="_blank" rel="noopener">云音乐技术团队的音频可视化开发案例</a>，快速帮助小白，制作自己喜欢的炫酷的音频可视化界面。</p>
<p>先上图</p>
<p><img src="E:%5C%E6%96%87%E4%BB%B6%5C%E6%8E%98%E9%87%91%5C1.png" alt=""></p>
<p>想开发这么一个炫酷的音频界面，我们可以先来聊聊 <strong>canvas</strong></p>
<h2 id="canvas是什么"><a href="#canvas是什么" class="headerlink" title="canvas是什么"></a>canvas是什么</h2><p><strong>canvas</strong>是HTML5中用于图形绘制的容器元素，它通常通过JavaScript脚本来完成图形绘制。要完成我们下面的音频可视化开发，我们可以借组结构canvas的几个方法，下面将通过开发一个页面倒计时的小案例来帮助初学者了解canvas的一些属性和方法。</p>
<p>先上代码</p>
<pre><code class="javascript">    &lt;canvas id=&quot;myCanvas&quot;&gt;  
    &lt;/canvas&gt;
    &lt;script&gt;
        const canvas = document.getElementById(&#39;myCanvas&#39;);
        var ctx = canvas.getContext(&#39;2d&#39;);
        ctx.fillStyle = &#39;red&#39;;
        ctx.font = &quot;50px Verdana&quot;;        
        let dis = 550;
        let i = 10;
        function animation(){
        requestAnimationFrame(function(){        
            if(dis &gt;= 0){
                --dis;
                if(dis%50 == 0 ){
                    ctx.clearRect(0,0,300,150);
                    ctx.fillText(i--,100,100);
                }
                animation();
            }                
        });
        }
        animation();
        &lt;/script&gt;</code></pre>
<p>我们在<code>html</code>页面创建一个<code>canvas</code>画布元素并设置id为<code>myCanvas</code>，它的默认大小是300*150，创建好了这块画布，接下来我们就能在JavaScript脚本中绘制图形了。</p>
<p>先通过<code>getElementById()</code>找到这个元素，然后创建canvas对象<code>ctx</code>并设置填充色为红色，字体为Verdana，大小为50px，设置<code>dis</code>变量用于条件控制，再定义一个<code>i</code>变量用于显示倒计时数字，然后我们就可以开始在我们的画布里绘制倒计时数字了。</p>
<p>创建一个<code>animation</code>函数，在这个函数里面，我们使用了一个html5专门用于请求动画的API<code>requestAnimationFrame</code>请求动画帧，相比于定时器<code>setTimeout</code>，它不会引起丢帧、丢帧，看起来更加流畅。</p>
<p>在<code>requestAnimationFrame</code>里面，先设置刷帧条件<code>dis&gt;=0</code>，<code>dis</code>每次减一，总共550次，再设置条件为每50次执行一次绘制操作，在每次绘制之前，通过<code>clearRect(x,y,width,height)</code>方法将画布上给定矩形清空，它的4个参数分别表示要清除的矩形左上角的x，y坐标，以及要清空矩形的宽度和高度，单位以像素计算。然后再通过<code>fillText()</code>画布指定位置绘制倒计时数字,该方法接收四个参数：<code>text</code>输出的文本，<code>x</code>绘制文本的x坐标，<code>y</code>绘制文本的y坐标，注意：这两个值都是相对于画布，最后一个参数<code>maxWidth</code>表示允许文本的最大宽度，它是一个可选参数。</p>
<p>接着我们通过递归的方式调用<code>animation()</code>函数直到倒计时结束，最后在外部调用一下<code>animation()</code>函数，至此，一个简单的倒计时界面完成。我们还可以给<code>canvas</code>通过<code>innerWidth</code>和<code>innerHeight</code>设置</p>
<p>画布大小。</p>
<p><code>canvas</code>可以绘制各种图形，更多内容请自行参看<code>canvas</code>内容</p>
<p>聊完了<code>canvas</code>，接下来就是我们的正题了。</p>
<h2 id="Web-Audio"><a href="#Web-Audio" class="headerlink" title="Web Audio"></a>Web Audio</h2><p>在开始之前，我们还需要了解什么是Web Audio。</p>
<blockquote>
<p>Web Audio 是 Web 端处理和分析音频的一套 API 。它可以使用户在音频上下文中进行音频操作，具有模块化路由的特点，它也使我们能够控制音频的空间化。</p>
</blockquote>
<p>通过Web Audio，我们能够实现<strong>取数据</strong>和<strong>映射数据</strong>两个过程，下面我们将实现这两个过程。</p>
<h2 id="项目实现"><a href="#项目实现" class="headerlink" title="项目实现"></a>项目实现</h2><p>我们先在页面创建一个<code>canvas</code>元素和一个<code>audio</code>标签以及一个用于作播放按钮的<code>a</code>标签。</p>
<p>然后在JavaScript里面获取<code>audio</code>和<code>a</code>这两个元素，并给<code>a</code>标签设置单击事件。</p>
<pre><code class="javascript">        var btn = document.getElementById(&#39;play-btn&#39;);
        var audio = document.getElementById(&#39;audio&#39;);
        btn.addEventListener(&#39;click&#39;,function(){
            btn.style.display = &#39;none&#39;;
            audio.play();
            onloadAudio();
        })</code></pre>
<p>在<code>onLoadAudio()</code>函数里面，我们先获取<code>canvas</code>元素，设置它占满整个页面，再创建<code>canvas</code>的对象。</p>
<pre><code class="javascript">        var canvas = document.getElementById(&#39;canvas&#39;);
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var ctx = canvas.getContext(&#39;2d&#39;);</code></pre>
<p>创建 *<em>AudioContext *</em>对象，用来控制它所包含的节点的创建，以及音频处理、解码操作的执行。</p>
<pre><code class="javascript">        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();</code></pre>
<p>通过 <code>createAnalyser()</code> 方法创建 *<em>AnalyserNode *</em>用来获取音频时间和频率数据，实现音频数据可视化。</p>
<pre><code class="javascript">        var analyser = audioCtx.createAnalyser();
        analyser.fftSize = 512;</code></pre>
<p>fftSize 在 <a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/fftSize" target="_blank" rel="noopener">MDN</a> 里面介绍是快速傅里叶变换的一个参数，取值必须是从32到32768范围内的2的非零幂，默认值为2048，在这里我们取512。另外，fftSize 的值决定了 frequencyData 的长度。</p>
<p>将音频节点关联到 <strong>AudioContext</strong>上，作为整个音频分析的输入。</p>
<p>我们采用<strong>MediaElementAudioSourceNode</strong> 将<code>&lt;audio&gt;</code>节点作为输入源，并将音频关联到分析器，再将分析器关联到输出设备。</p>
<pre><code class="javascript">        var source = audioCtx.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);</code></pre>
<p>接下来获取频率数组。</p>
<pre><code class="javascript">        var bufferLength = analyser.frequencyBinCount;
        var dataArray = new Uint8Array(bufferLength);</code></pre>
<p><code>frequencyBinCount()</code>的值是 fftSize 取值的一半，所以这里的 Uint8Array() 数组的长度就是256。</p>
<p>然后设置音柱的宽度，而高度只定义变量而不赋值，留在后面通过<code>dataArray[]</code>数组动态设置</p>
<pre><code class="javascript">        var barWidth = WIDTH / bufferLength*1.5;
        var barHeight;</code></pre>
<h3 id="绘制音柱"><a href="#绘制音柱" class="headerlink" title="绘制音柱"></a>绘制音柱</h3><p>定义一个 <code>renderFrame()</code> 函数用于绘制音柱，并且每次绘制之前都先将整个画布清除，然后更新频率数组。</p>
<pre><code>        ctx.clearRect(0,0,WIDTH,HEIGHT);
        analyser.getByteFrequencyData(dataArray);</code></pre><p>通过<code>for</code>循环里面设置每一个矩形的高度，再根据高度设置一个背景色，然后绘制矩形，并填充背景颜色。然后通过递归的方式调用函数。</p>
<pre><code class="javascript">        barHeight = dataArray[i];
        var r = barHeight + 25 * (i / bufferLength);
        var g = 250 * (i / bufferLength);
        var b = 50;
        ctx.fillStyle = &quot;rgb(&quot; + r + &quot;,&quot; + g + &quot;,&quot; + b + &quot;)&quot;;
        ctx.fillRect(x,HEIGHT-barHeight,barWidth,barHeight);
        x += barWidth+2;</code></pre>
<p>最后，运行代码，体验属于你的可视化音乐吧。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本文简单介绍了 canvas 的使用和如何通过 Web Audio 的相关 API 获取音频的频率数据。</p>
<p>然而 <code>canvas</code> 和 <code>Web Audio</code>的用处远远不止于此，读者还可以发挥想象力和创造力，开发出更多有意思的项目。</p>
<p>附上项目源码：<a href="https://github.com/anpeier/lesson_shuidi/tree/master/html5/visualize" target="_blank" rel="noopener">https://github.com/anpeier/lesson_shuidi/tree/master/html5/visualize</a></p>

    </div>
    
    <div class="reward" ontouchstart>
    <div class="reward-wrap">赏
        <div class="reward-box">
            
            <span class="reward-type">
                <img class="alipay" src="/img/alipay.jpg"><b>支付宝打赏</b>
            </span>
            
            
            <span class="reward-type">
                <img class="wechat" src="/img/we.png"><b>微信打赏</b>
            </span>
            
        </div>
    </div>
    <p class="reward-tip">
        赞赏是不耍流氓的鼓励
    </p>
</div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">anpeier</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    
    <a href="/2019/11/23/hello-world/" class="next-post btn btn-default" title='分类测试'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            分类测试</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>
<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'xOKV9J4UeQAtVkvnJC7Kq2Jn-gzGzoHsz',
    appKey: 'erIpQac4azoCmgfBB7Dl9maa',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'zh-CN'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#快速上手网易云音乐可视化"><span class="toc-text">快速上手网易云音乐可视化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是音频可视化"><span class="toc-text">什么是音频可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#canvas是什么"><span class="toc-text">canvas是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-Audio"><span class="toc-text">Web Audio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目实现"><span class="toc-text">项目实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#绘制音柱"><span class="toc-text">绘制音柱</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-text">小结</span></a></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
    访问量:
    <strong id="busuanzi_value_site_pv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    &nbsp; | &nbsp;
    访客数:
    <strong id="busuanzi_value_site_uv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2019
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>


<script src="/assets/tagcanvas.min.js?rev=2.9"></script>
<script>
var tagOption = {
    textColour: '#444', // 字体颜色
    outlineMethod: 'block', // 选中模式
    outlineColour: '#FFDAB9', // 选中模式的颜色
    interval: 30 || 30, // 动画帧之间的时间间隔，值越大，转动幅度越大
    textHeight: 13,
    outlineRadius: 3,
    freezeActive: true || '', // 选中的标签是否继续滚动
    frontSelect: true || '', // 不选标签云后部的标签
    initial: [0.1, -0.1],
    depth: 0.5,
    decel: 0.95,
    maxSpeed: 0.03,
    reverse: true || '', // 是否反向触发
    fadeIn: 500, // 进入动画时间
    wheelZoom: false || '' // 是否启用鼠标滚轮
}
TagCanvas.Start('tag-cloud-3d', '', tagOption);
</script>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/js/app.js?rev=@@hash"></script>
</body>
</html>